<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <!--  è¦ç¡®è®¤echarts.jsæ‰€åœ¨çš„è·¯å¾„æ˜¯æ­£ç¡®çš„ -->
    <script type="text/javascript" src="./echarts.js"></script>
    <script src="./fxp.min.js"></script>
    <!-- å¤–éƒ¨urlå¼•å…¥ -->
    <!-- <script type="text/javascript" src="https://cdn.jsdelivr.net/npm/echarts@5.5.0/dist/echarts.js"></script> -->
    <title></title>
  </head>
  <body>
    <style type="text/css">
      #demo {
        /* å¿…é¡»è®¾ç½®å®½é«˜*/
        width: 1000px;
        height: 500px;
      }
    </style>
    <div id="demo"></div>
  </body>
  <script>
    function processColumn3DXML(xmlContent) {
      var options = {
        ignoreAttributes: false,
        attributeNamePrefix: '',
        parseAttributeValue: true
      }

      var colorlist = [
        '#99afc3',
        '#d4b74b',
        '#91ab36',
        '#c38658',
        '#6fb0b0',
        '#d48f8f',
        '#aa85ae',
        '#99ae7b',
        '#beba53',
        '#85bee1',
        '#9f4448',
        '#c3b7d3',
        '#cf9f68',
        '#e5c9a3',
        '#c8c573',
        '#e6a9b3'
      ]

      var parser = new fxp.XMLParser(options)
      var jsonObj = parser.parse(xmlContent)
      console.log('ðŸš€ >> processColumn3DXML >> jsonObj :', jsonObj)

      var obj = {
        title: jsonObj.chart.caption,
        unitLeft: jsonObj.chart.PYAxisName,
        unitRight: jsonObj.chart.SYAxisName,
        legend: [],
        categories: [],
        xAxisObj: {}
      }

      var categories = jsonObj.chart.categories.category || []
      obj.categories = categories.map(function (category) {
        return category.label
      })

      var dataset = jsonObj.chart.dataset || []
      dataset.forEach(function (data) {
        obj.legend.push(data.seriesName)
        var key = data.seriesName
        var arr = []

        for (var index = 0; index < data.set.length; index++) {
          arr.push(data.set[index].value)
        }

        obj.xAxisObj[key] = arr
      })

      return obj
    }
  </script>

  <script type="text/javascript">
    var xmlContent = `<?xml version="1.0" encoding="utf-8"?>
<chart PYAxisName="æ•°é‡" SYAxisName="åŒæ¯”å¢žé•¿(%)" baseFontSize="12" bgColor="#F4F6F9" canvasBgColor="#FFFFFF" caption="åˆ‘äº‹æ¡ˆä»¶æ‰¿åŠžæƒ…å†µæ•°æ®åŒæ¯”" palette="1" paletteColors="008E8E,FFBB1C,FFD700" showAboutMenuItem="0" showPrintMenuItem="0" showValues="0">
  <categories><category label="é€šçŸ¥è¾©æŠ¤"/>
    <category label="é€šçŸ¥ä»£ç†"/>
    <category label="ä¾¦æŸ¥é˜¶æ®µ"/>
    <category label="å®¡æŸ¥èµ·è¯‰é˜¶æ®µ"/>
    <category label="å®¡åˆ¤é˜¶æ®µ"/>
    <category label="ç”³è¯‰"/>
    <category label="å†å®¡"/>
    </categories>
    <dataset parentYAxis="P" renderAs="Line" seriesName="åŽ»å¹´åŒæœŸ">
      <set value="0"/>
      <set value="0"/>
      <set value="0"/>
      <set value="0"/>
      <set value="0"/>
      <set value="0"/>
      <set value="0"/>
      </dataset>
      <dataset parentYAxis="S" renderAs="Column" seriesName="åŒæ¯”å¢žé•¿ï¼ˆ%ï¼‰">
        <set value="9223372036854776000.00"/><set value="0.00"/>
        <set value="9223372036854776000.00"/>
        <set value="9223372036854776000.00"/>
        <set value="9223372036854776000.00"/>
        <set value="0.00"/>
        <set value="0.00"/>
        </dataset>
        <dataset parentYAxis="P" renderAs="Line" seriesName="å½“å‰ç»Ÿè®¡æ—¶é—´">
          <set value="2"/>
          <set value="0"/>
          <set value="1"/>
          <set value="1"/>
          <set value="1"/>
          <set value="0"/>
          <set value="0"/>
          </dataset>
          <trendlines>
            <line color="91C728" displayValue="Target" showOnTop="1" startValue="26000"/></trendlines>
            <styles>
              <definition><style duration="1" name="CanvasAnim" param="_xScale" start="0" type="animation"/>
                </definition>
                <application><apply styles="CanvasAnim" toObject="Canvas"/></application></styles>
            </chart>`

    var obj = processColumn3DXML(xmlContent)

    console.log('ðŸš€ >> obj:', obj)
    var title = obj.title
    var items = obj.items
    var category = obj.category
    var categories = obj.categories
    var unitLeft = obj.unitLeft
    var unitRight = obj.unitRight
    var legend = obj.legend
    var data1 = obj.xAxisObj['åŽ»å¹´åŒæœŸ']
    var data2 = obj.xAxisObj['åŒæ¯”å¢žé•¿ï¼ˆ%ï¼‰']
    var data3 = obj.xAxisObj['å½“å‰ç»Ÿè®¡æ—¶é—´']

    var echartInstance = echarts.init(document.getElementById('demo'))
    var option = {
      title: {
        text: title,
        left: 'center'
      },

      grid: {
        x: 100, //å·¦
        y: 50, //ä¸Š
        x2: 120, //å³
        y2: 120 //ä¸‹
      },

      tooltip: {
        trigger: 'axis',
        axisPointer: {
          type: 'cross',
          crossStyle: {
            color: '#999'
          }
        }
      },

      legend: {
        data: legend,
        bottom: 0
      },
      xAxis: [
        {
          type: 'category',
          data: categories,
          axisPointer: {
            type: 'shadow'
          },
          axisTick: {
            show: false
          },
          minInterval: 0,
          axisLabel: {
            overflow: 'break',
            interval: 0,
            formatter: function (value) {
              var str = ''
              var num = 3 //æ¯è¡Œæ˜¾ç¤ºå­—æ•°
              var valLength = value.length //è¯¥é¡¹xè½´å­—æ•°
              var rowNum = Math.ceil(valLength / num) // è¡Œæ•°
              if (rowNum > 1) {
                for (var i = 0; i < rowNum; i++) {
                  var temp = ''
                  var start = i * num
                  var end = start + num

                  temp = value.substring(start, end) + '\n'
                  str += temp
                }
                return str
              } else {
                return value
              }
            }
          }
        }
      ],
      yAxis: [
        {
          type: 'value',
          name: unitLeft,
          nameLocation: 'middle',
          nameGap: 60,
          min: 3,
          axisLabel: {
            formatter: '{value}'
          }
        },
        {
          type: 'value',
          name: unitRight,
          nameLocation: 'middle',
          nameGap: 60,
          min: 1,
          axisLabel: {
            formatter: '{value}'
          },
          splitArea: {
            show: true,
            areaStyle: {
              color: '#fefefe'
            }
          }
        }
      ],
      series: [
        {
          name: legend[0],
          type: 'bar',
          data: data1,
          tooltip: {
            valueFormatter: function (value) {
              return value + 'ä»¶'
            }
          }
        },
        {
          name: legend[2],
          type: 'bar',
          data: data3,
          tooltip: {
            valueFormatter: function (value) {
              return value + 'ä»¶'
            }
          }
        },
        {
          name: legend[1],
          type: 'line',
          data: data2,
          yAxisIndex: 1,
          tooltip: {
            valueFormatter: function (value) {
              return value / 100 + '%'
            }
          }
        }
      ]
    }

    echartInstance.setOption(option)
  </script>
</html>
